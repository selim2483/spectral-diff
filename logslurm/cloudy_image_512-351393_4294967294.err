/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/fabric/utilities/seed.py:44: No seed found, seed set to 0
[rank: 0] Seed set to 0
Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.model_summary.ModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
wandb: Currently logged in as: selimollivier24 (selimollivier247) to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.23.0
wandb: Run data is saved locally in /scratchm/sollivie/spectral-diff/runs/cloudy_image_512/wandb/run-20251128_134601-d2aws8w8
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run cloudy_image_512
wandb: ‚≠êÔ∏è View project at https://wandb.ai/selimollivier247/spectralDiff
wandb: üöÄ View run at https://wandb.ai/selimollivier247/spectralDiff/runs/d2aws8w8
/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:751: Checkpoint directory /scratchm/sollivie/spectral-diff/runs/cloudy_image_512 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

   | Name                        | Type             | Params | Mode  | In sizes                    | Out sizes       
---------------------------------------------------------------------------------------------------------------------------
0  | model                       | UNet             | 5.4 M  | train | ?                           | ?               
1  | model.time_mlp              | Sequential       | 2.1 K  | train | ?                           | ?               
2  | model.time_mlp.0            | SinusoidalPosEmb | 0      | train | ?                           | ?               
3  | model.time_mlp.1            | Linear           | 1.1 K  | train | ?                           | ?               
4  | model.time_mlp.2            | GELU             | 0      | train | ?                           | ?               
5  | model.time_mlp.3            | Linear           | 1.0 K  | train | ?                           | ?               
6  | model.downs                 | ModuleList       | 2.3 M  | train | ?                           | ?               
7  | model.downs.0               | ModuleList       | 34.9 K | train | ?                           | ?               
8  | model.downs.1               | ModuleList       | 133 K  | train | ?                           | ?               
9  | model.downs.2               | ModuleList       | 494 K  | train | ?                           | ?               
10 | model.downs.3               | ModuleList       | 1.6 M  | train | ?                           | ?               
11 | model.ups                   | ModuleList       | 1.2 M  | train | ?                           | ?               
12 | model.ups.0                 | ModuleList       | 911 K  | train | ?                           | ?               
13 | model.ups.1                 | ModuleList       | 241 K  | train | ?                           | ?               
14 | model.ups.2                 | ModuleList       | 67.4 K | train | ?                           | ?               
15 | model.mid_block1            | ConvNextBlock    | 894 K  | train | ?                           | ?               
16 | model.mid_block1.mlp        | Sequential       | 2.2 K  | train | ?                           | ?               
17 | model.mid_block1.ds_conv    | Conv2d           | 6.4 K  | train | ?                           | ?               
18 | model.mid_block1.net        | Sequential       | 885 K  | train | ?                           | ?               
19 | model.mid_block1.res_conv   | Identity         | 0      | train | ?                           | ?               
20 | model.mid_attn              | Residual         | 65.9 K | train | ?                           | ?               
21 | model.mid_attn.fn           | PreNorm          | 65.9 K | train | ?                           | ?               
22 | model.mid_block2            | ConvNextBlock    | 894 K  | train | ?                           | ?               
23 | model.mid_block2.mlp        | Sequential       | 2.2 K  | train | ?                           | ?               
24 | model.mid_block2.ds_conv    | Conv2d           | 6.4 K  | train | ?                           | ?               
25 | model.mid_block2.net        | Sequential       | 885 K  | train | ?                           | ?               
26 | model.mid_block2.res_conv   | Identity         | 0      | train | ?                           | ?               
27 | model.final_conv            | Sequential       | 14.7 K | train | ?                           | ?               
28 | model.final_conv.0          | ConvNextBlock    | 14.7 K | train | ?                           | ?               
29 | model.final_conv.1          | Conv2d           | 17     | train | ?                           | ?               
30 | ema_model                   | EMA              | 5.4 M  | train | [[8, 1, 256, 256], []]      | ?               
31 | ema_model.module            | UNet             | 5.4 M  | eval  | [[8, 1, 256, 256], []]      | ?               
32 | ema_model.module.time_mlp   | Sequential       | 2.1 K  | eval  | [8]                         | [8, 16]         
33 | ema_model.module.downs      | ModuleList       | 2.3 M  | eval  | ?                           | ?               
34 | ema_model.module.ups        | ModuleList       | 1.2 M  | eval  | ?                           | ?               
35 | ema_model.module.mid_block1 | ConvNextBlock    | 894 K  | eval  | [[8, 128, 32, 32], [8, 16]] | [8, 128, 32, 32]
36 | ema_model.module.mid_attn   | Residual         | 65.9 K | eval  | [8, 128, 32, 32]            | [8, 128, 32, 32]
37 | ema_model.module.mid_block2 | ConvNextBlock    | 894 K  | eval  | [[8, 128, 32, 32], [8, 16]] | [8, 128, 32, 32]
38 | ema_model.module.final_conv | Sequential       | 14.7 K | eval  | [8, 16, 256, 256]           | [8, 1, 256, 256]
---------------------------------------------------------------------------------------------------------------------------
10.8 M    Trainable params
0         Non-trainable params
10.8 M    Total params
43.138    Total estimated model params size (MB)
257       Modules in train mode
256       Modules in eval mode
SLURM auto-requeueing enabled. Setting signal handlers.
/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/plotly/matplotlylib/renderer.py:564: UserWarning:

I found a path object that I don't think is part of a bar chart. Ignoring.

/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/fit_loop.py:310: PossibleUserWarning:

The number of training batches (6) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.

/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/fit_loop.py:527: PossibleUserWarning:

Found 256 module(s) in eval mode at the start of training. This may lead to unexpected behavior during training. If this is intentional, you can ignore this warning.

Traceback (most recent call last):
  File "/scratchm/sollivie/spectral-diff/src/spectral_diff/image.py", line 70, in <module>
    cli_main()
    ~~~~~~~~^^
  File "/scratchm/sollivie/spectral-diff/src/spectral_diff/image.py", line 66, in cli_main
    cli = CustomCLI(
        Diffusion, save_config_kwargs={"overwrite": True})
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/cli.py", line 414, in __init__
    self._run_subcommand(self.subcommand)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/cli.py", line 747, in _run_subcommand
    fn(**fn_kwargs)
    ~~^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 560, in fit
    call._call_and_handle_interrupt(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, self._fit_impl, model, train_dataloaders, val_dataloaders, datamodule, ckpt_path
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/call.py", line 49, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 598, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 1011, in _run
    results = self._run_stage()
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 1055, in _run_stage
    self.fit_loop.run()
    ~~~~~~~~~~~~~~~~~^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/fit_loop.py", line 216, in run
    self.advance()
    ~~~~~~~~~~~~^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/fit_loop.py", line 458, in advance
    self.epoch_loop.run(self._data_fetcher)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 152, in run
    self.advance(data_fetcher)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 310, in advance
    batch, _, __ = next(data_fetcher)
                   ~~~~^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/fetchers.py", line 134, in __next__
    batch = super().__next__()
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/fetchers.py", line 61, in __next__
    batch = next(self.iterator)
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/utilities/combined_loader.py", line 341, in __next__
    out = next(self._iterator)
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/utilities/combined_loader.py", line 78, in __next__
    out[i] = next(self.iterators[i])
             ~~~~^^^^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/utils/data/dataloader.py", line 1506, in _next_data
    return self._process_data(data, worker_id)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/utils/data/dataloader.py", line 1541, in _process_data
    data.reraise()
    ~~~~~~~~~~~~^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/_utils.py", line 769, in reraise
    raise exception
ValueError: Caught ValueError in DataLoader worker process 0.
Original Traceback (most recent call last):
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/utils/data/_utils/worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/scratchm/sollivie/spectral-diff/src/spectral_diff/data/cloudy.py", line 50, in __getitem__
    img = self.transform(img)
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torchvision/transforms/transforms.py", line 95, in __call__
    img = t(img)
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torchvision/transforms/transforms.py", line 681, in forward
    i, j, h, w = self.get_params(img, self.size)
                 ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/scratchm/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/torchvision/transforms/transforms.py", line 640, in get_params
    raise ValueError(f"Required crop size {(th, tw)} is larger than input image size {(h, w)}")
ValueError: Required crop size (512, 512) is larger than input image size (474, 512)

