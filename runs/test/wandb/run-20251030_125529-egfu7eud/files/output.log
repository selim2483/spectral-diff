/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:751: Checkpoint directory /tmp_user/juno/sollivie/spectral-diff/runs/test exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
tensor(9)
tensor(8)
tensor(7)
tensor(6)
tensor(5)
tensor(4)
tensor(3)
tensor(2)
tensor(1)
tensor(0)

   | Name                            | Type              | Params | Mode  | In sizes                     | Out sizes
-----------------------------------------------------------------------------------------------------------------------------------
0  | model                           | UNet2DModel       | 274 M  | train | ?                            | ?
1  | model.conv_in                   | Conv2d            | 6.3 K  | train | ?                            | ?
2  | model.time_proj                 | Timesteps         | 0      | train | ?                            | ?
3  | model.time_embedding            | TimestepEmbedding | 1.0 M  | train | ?                            | ?
4  | model.time_embedding.linear_1   | Linear            | 201 K  | train | ?                            | ?
5  | model.time_embedding.act        | SiLU              | 0      | train | ?                            | ?
6  | model.time_embedding.linear_2   | Linear            | 803 K  | train | ?                            | ?
7  | model.down_blocks               | ModuleList        | 73.2 M | train | ?                            | ?
8  | model.down_blocks.0             | DownBlock2D       | 2.7 M  | train | ?                            | ?
9  | model.down_blocks.1             | AttnDownBlock2D   | 10.6 M | train | ?                            | ?
10 | model.down_blocks.2             | AttnDownBlock2D   | 24.1 M | train | ?                            | ?
11 | model.down_blocks.3             | AttnDownBlock2D   | 35.7 M | train | ?                            | ?
12 | model.up_blocks                 | ModuleList        | 166 M  | train | ?                            | ?
13 | model.up_blocks.0               | AttnUpBlock2D     | 87.1 M | train | ?                            | ?
14 | model.up_blocks.1               | AttnUpBlock2D     | 50.6 M | train | ?                            | ?
15 | model.up_blocks.2               | AttnUpBlock2D     | 22.9 M | train | ?                            | ?
16 | model.up_blocks.3               | UpBlock2D         | 5.5 M  | train | ?                            | ?
17 | model.mid_block                 | UNetMidBlock2D    | 33.7 M | train | ?                            | ?
18 | model.mid_block.attentions      | ModuleList        | 3.2 M  | train | ?                            | ?
19 | model.mid_block.resnets         | ModuleList        | 30.5 M | train | ?                            | ?
20 | model.conv_norm_out             | GroupNorm         | 448    | train | ?                            | ?
21 | model.conv_act                  | SiLU              | 0      | train | ?                            | ?
22 | model.conv_out                  | Conv2d            | 6.1 K  | train | ?                            | ?
23 | ema_model                       | EMA               | 274 M  | train | [[8, 3, 256, 256], []]       | ?
24 | ema_model.module                | UNet2DModel       | 274 M  | eval  | [[8, 3, 256, 256], []]       | ?
25 | ema_model.module.conv_in        | Conv2d            | 6.3 K  | eval  | [8, 3, 256, 256]             | [8, 224, 256, 256]
26 | ema_model.module.time_proj      | Timesteps         | 0      | eval  | [8]                          | [8, 224]
27 | ema_model.module.time_embedding | TimestepEmbedding | 1.0 M  | eval  | [8, 224]                     | [8, 896]
28 | ema_model.module.down_blocks    | ModuleList        | 73.2 M | eval  | ?                            | ?
29 | ema_model.module.up_blocks      | ModuleList        | 166 M  | eval  | ?                            | ?
30 | ema_model.module.mid_block      | UNetMidBlock2D    | 33.7 M | eval  | [[8, 896, 32, 32], [8, 896]] | [8, 896, 32, 32]
31 | ema_model.module.conv_norm_out  | GroupNorm         | 448    | eval  | [8, 224, 256, 256]           | [8, 224, 256, 256]
32 | ema_model.module.conv_act       | SiLU              | 0      | eval  | [8, 224, 256, 256]           | [8, 224, 256, 256]
33 | ema_model.module.conv_out       | Conv2d            | 6.1 K  | eval  | [8, 224, 256, 256]           | [8, 3, 256, 256]
-----------------------------------------------------------------------------------------------------------------------------------
548 M     Trainable params
0         Non-trainable params
548 M     Total params
2,192.449 Total estimated model params size (MB)
375       Modules in train mode
374       Modules in eval mode
Sanity Checking DataLoader 0:   0%|                                                                                                                                                   | 0/1 [00:00<?, ?it/s]torch.Size([4, 3, 360, 360])
tensor(9)
tensor(8)
tensor(7)
tensor(6)
tensor(5)
tensor(4)
tensor(3)
tensor(2)
tensor(1)
tensor(0)
Traceback (most recent call last):
  File "/tmp_user/juno/sollivie/spectral-diff/src/spectral_diff/main.py", line 68, in <module>
    cli_main()
    ~~~~~~~~^^
  File "/tmp_user/juno/sollivie/spectral-diff/src/spectral_diff/main.py", line 65, in cli_main
    cli = CustomCLI(Diffusion, save_config_kwargs={"overwrite": True})
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/cli.py", line 414, in __init__
    self._run_subcommand(self.subcommand)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/cli.py", line 747, in _run_subcommand
    fn(**fn_kwargs)
    ~~^^^^^^^^^^^^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 560, in fit
    call._call_and_handle_interrupt(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, self._fit_impl, model, train_dataloaders, val_dataloaders, datamodule, ckpt_path
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/call.py", line 49, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 598, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 1011, in _run
    results = self._run_stage()
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 1053, in _run_stage
    self._run_sanity_check()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/trainer.py", line 1082, in _run_sanity_check
    val_loop.run()
    ~~~~~~~~~~~~^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/utilities.py", line 179, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 145, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/loops/evaluation_loop.py", line 451, in _evaluation_step
    call._call_callback_hooks(trainer, hook_name, output, *hook_kwargs.values())
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp_user/juno/sollivie/spectral-diff/.pixi/envs/default/lib/python3.13/site-packages/lightning/pytorch/trainer/call.py", line 228, in _call_callback_hooks
    fn(trainer, trainer.lightning_module, *args, **kwargs)
    ~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp_user/juno/sollivie/spectral-diff/src/spectral_diff/utils/logging.py", line 192, in on_validation_batch_end
    value = _metric_dict[metric](target, sample, self.options)
  File "/tmp_user/juno/sollivie/spectral-diff/src/spectral_diff/metrics.py", line 116, in gradients_distance
    return sliced_wasserstein_distance(
        gradients.image_gradient(target, result='mag'),
        gradients.image_gradient(synth, result='mag'),
        nslice=options.ngrad, batch_size=options.bgrad
    )
TypeError: sliced_wasserstein_distance() got an unexpected keyword argument 'nslice'
